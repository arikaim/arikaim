{% import systemMacro("extensions.html") as macros %}
{% import systemMacro("list.html") as list %}

{% set data = executeMethod("Extension\\ExtensionsManager","getExtensionDetails",extension_name)  %}
{% set extension = executeMethod("Extension\\ExtensionsManager","getExtensionProperties",extension_name) %}
<div class="ui header">
    <i class="left floated rounded big bordered icon {{ extension.icon }}"></i>  
    <div class="content">
        {{ extension.title }} 
        <div class="ui label">
            {{ labels.version }}
            <div class="detail">
                {{ extension.version }}
            </div>
        </div>
        <div class="sub header">{{ extension.description }}</div>
    </div> 
</div>
<div class="ui top attached tabular menu" id="extension_details_tab">
    <a class="item active" data-tab="routes_tab">
        <i class="icon linkify"></i>
        {{ tabs.routes.content }}
    </a> 
    <a class="item" data-tab="database_tab">
        <i class="icon database"></i>
        {{ tabs.database.content }}
    </a> 
    <a class="item" data-tab="events_tab">
        <i class="icon checked calendar"></i>
        {{ tabs.events.content }}
    </a> 
    <a class="item" data-tab="template_tab">
        <i class="icon browser"></i>
        {{ tabs.view.content }}
    </a>
    <a class="item" data-tab="jobs_tab">
        <i class="icon repeat"></i>
        {{ tabs.jobs.content }}
    </a>        
</div>
<div class="ui bottom attached tab segment active {{ tabs.routes.class }}" data-tab="routes_tab">
    {{ macros.routesList(data.routes,"linkify") }}
</div>
<div class="ui bottom attached tab segment {{ tabs.database.class }}" data-tab="database_tab">
    {{ list.itemsList(data.database,"database") }} 
</div>
<div class="ui up tab {{ tabs.events.class }}" data-tab="events_tab" id="events_tab">
    <div class="ui horizontal divider"></div>
    <div class="ui top attached tabular mini menu">
        <a class="item active" data-tab="events_tab/registered_events_tab">
            <i class="icon checked calendar"></i>
            {{ tabs.events.content }}
        </a>
        <a class="item" data-tab="events_tab/subscribers_tab">
            <i class="icon code"></i>
            {{ tabs.subscribers.content }}
        </a>
    </div>
    <div class="ui bottom attached tab segment active {{ tabs.events.class }}" data-tab="events_tab/registered_events_tab">
        {{ list.itemsList(data.events,"checked calendar") }} 
    </div>
    <div class="ui bottom attached tab segment {{ tabs.subscribers.class }}" data-tab="events_tab/subscribers_tab">
        {{ macros.subscribersLits(data.subscribers,"code") }} 
    </div>
</div>
<div class="ui up tab {{ tabs.template.class }}" data-tab="template_tab">
    <div class="ui horizontal divider"></div>
    <div class="ui top attached tabular mini menu" id="template_tab">
        <a class="item active" data-tab="template_tab/components_tab">
            <i class="icon code"></i>
            {{ tabs.components.content }}
        </a>     
        <a class="item" data-tab="template_tab/pages_tab">
            <i class="icon file text outline"></i>
            {{ tabs.pages.content }}
        </a> 
        <a class="item" data-tab="template_tab/macros_tab">
            <i class="icon settings"></i>
            {{ tabs.macros.content }}
        </a>                
    </div>
    <div class="ui bottom attached tab segment active {{ tabs.components.class }}" data-tab="template_tab/components_tab">
        {{ list.itemsList(data.components,"code") }} 
    </div>
    <div class="ui bottom attached tab segment {{ tabs.pages.class }}" data-tab="template_tab/pages_tab">
        {{ list.itemsList(data.pages,"file text outline") }} 
    </div>
    <div class="ui bottom attached tab segment {{ tabs.macros.class }}" data-tab="template_tab/macros_tab">
        {{ list.itemsList(data.macros,"settings") }} 
    </div>
</div>
<div class="ui bottom attached tab segment {{ tabs.jobs.class }}" data-tab="jobs_tab">
    <h5 class="header">
        <i class="icon repeat"></i>
        {{ labels.recuring }}
    </h5>
    {% set jobs_filter = condition('extension_name','=',extension_name) %}
    {% set recuring_jobs = condition('recuring_interval','<>','',jobs_filter) %}
    {{ component('system:admin.system.jobs.list',{ filter: [recuring_jobs] }) }}
    <h5 class="header">
        <i class="icon wait"></i>
        {{ labels.scheduled }}
    </h5>
    {% set scheduled_jobs = condition('schedule_time','>','0',jobs_filter) %}
    {{ component('system:admin.system.jobs.list',{ filter: [scheduled_jobs] }) }}
</div>